<%= render partial: 'shared/navbar' %>
<div id="map" style="display:inline-block;"></div>
<script>
  function initMap() {
    var current_location = new google.maps.LatLng(41.901695, -87.7094092);

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: current_location
    });
    var marker = new google.maps.Marker({
      position: current_location,
      map: map
    });

    var infoWindow = new google.maps.InfoWindow;

    $.getJSON('/properties/properties_json', function (results) {
      for (var i = 0; i < results.length; i++) {
        console.log(results[i]);
        var latLng = new google.maps.LatLng(results[i].latitude,results[i].longitude);
        var marker = new google.maps.Marker({
          position: latLng,
          map: map
        });
      }
    })
  }

  ///// SEARCHBOX ////

 //  var query = new google.maps.places.SearchBox(document.getElementById('pac-input'));
 //   map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById('pac-input'));
 //   google.maps.event.addListener(searchBox, 'places_changed', function() {
 //     searchBox.set('map', null);
 //
 //
 //     var places = searchBox.getPlaces();
 //
 //     var bounds = new google.maps.LatLngBounds();
 //     var i, place;
 //     for (i = 0; place = places[i]; i++) {
 //       (function(place) {
 //         var marker = new google.maps.Marker({
 //
 //           position: place.geometry.location
 //         });
 //         marker.bindTo('map', searchBox, 'map');
 //         google.maps.event.addListener(marker, 'map_changed', function() {
 //           if (!this.getMap()) {
 //             this.unbindAll();
 //           }
 //         });
 //         bounds.extend(place.geometry.location);
 //
 //
 //       }(place));
 //
 //     }
 //     map.fitBounds(bounds);
 //     searchBox.set('map', map);
 //     map.setZoom(Math.min(map.getZoom(),12));
 //
 //   });
 // }
 // google.maps.event.addDomListener(window, 'load', init);
 //
  // $(document).ready(function()
  // {
  //   navigator.geolocation.getCurrentPosition(initMap)
  // });
  //
  //
  //      GEOLOCATION
  //   if (navigator.geolocation) {
  //     navigator.geolocation.getCurrentPosition(function(position) {
  //       var pos = {
  //         lat: position.coords.latitude,
  //         lng: position.coords.longitude
  //       };
  //
  //       infoWindow.setPosition(pos);
  //       infoWindow.setContent('Location found.');
  //       infoWindow.open(map);
  //       map.setCenter(pos);
  //     }, function() {
  //       handleLocationError(true, infoWindow, map.getCenter());
  //     });
  //   } else {
  //     // Browser doesn't support Geolocation
  //     handleLocationError(false, infoWindow, map.getCenter());
  //   }
  // }
  //
  // function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  //   infoWindow.setPosition(pos);
  //   infoWindow.setContent(browserHasGeolocation ?
  //                         'Error: The Geolocation service failed.' :
  //                         'Error: Your browser doesn\'t support geolocation.');
  //   infoWindow.open(map);
  // }
  //



</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?libraries=places&sensor=false?key=AIzaSyB-sQVuX8b2ECGCusIws9k7Jta3g2-n6zg&callback=initMap">
</script>

<div class="q
ueries" style="display:inline-block; vertical-align:top;">
  <div id="map"></div>
  <h2>Real Estate</h2>
  <nav>
      <ul class="nav nav-pills">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#/properties/most_popular">Most Popular</a></li>
        <li><a href="/properties/newest">Most Recent</a></li>
        <li><a href="/properties/low_to_high">Rent (low to high)</a></li>
      </ul>
  </nav>
  <div class="listings" style="background-color:grey;">
    <table class="table table-striped" style="width:600px;">
      <tr>
          <th>Address</th>
          <th>Price</th>
          <th>Contact</th>
          <th></th>
      </tr>
      <% @p.each do |a| %>
      <tr>
          <td><%=a.address%>,<%=a.state%>
            <%=a.zipcode%></td>
          <% if a.status == "For Rent"%>
            <td>$<%=a.price%>/month</td>
          <% else %>
            <td>$<%=a.price%>/month</td>
          <% end %>
          <td><b><%=a.contact_name%></b>
            <p><%=a.contact_email%></p><p>Phone: <%=a.contact_phone%></p>
          </td>
          <td><a href="/properties/<%=a.id%>/detail_page">Details</a></td>
      </tr>
      <% end %>
    </table>
  </div>
</div>
